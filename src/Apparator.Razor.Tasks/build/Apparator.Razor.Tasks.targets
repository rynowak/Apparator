<Project>
  <Target
    Name="RazorCompile" 
    DependsOnTargets="ResolveAssemblyReferences;CoreCompile"
    Inputs="$(MSBuildAllProjects);$(IntermediateOutputPath)$(TargetName)$(TargetExt)"
    Outputs="$(IntermediateOutputPath)$(TargetName).PrecompiledViews$(TargetExt)">

    <PropertyGroup>
      <_RazorOutputAssembly>$(IntermediateOutputPath)$(TargetName).PrecompiledViews$(TargetExt)</_RazorOutputAssembly>
    </PropertyGroup>
    
    <ItemGroup>
      <_RazorReferencePath Include="@(ReferencePath)"/>
      <_RazorReferencePath Include="$([System.IO.Path]::GetFullPath('$(IntermediateOutputPath)$(TargetName)$(TargetExt)'))"/>
    </ItemGroup>

    <ItemGroup>
      <_RazorCompile Include="@(Content)" Condition="'%(Extension)'=='.cshtml'" />
    </ItemGroup>

    <Rzc
      References="@(_RazorReferencePath)"
      OutputAssembly="$(_RazorOutputAssembly)"
      ProjectRoot="$(MSBuildProjectDirectory)"
      Sources="@(_RazorCompile)">
      
    </Rzc>
  </Target>
</Project>
